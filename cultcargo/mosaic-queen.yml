_include:
  - genesis/cult-cargo-base.yml

cabs:
  mosaic-queen:
    info: Mosaicking commands from montage, that also does primary-beam correction (https://github.com/caracal-pipeline/MosaicQueen)
    command: mosaic-queen
    image: 
      _use: vars.cult-cargo.images
      name: mosaic-queen
    policies:
      prefix: '--'
      replace: {'_': '-'}
  inputs:
    input:
      dtype: Directory
      must_exist: true
      required: true
      policies:
        positional: true
      info: Directory containing the (2D or 3D) images and beams.
    target-images:
      dtype: List[File]
      required: true
      policies:
        positional: true
      info: Space-separated list of images to be mosaicked; 'image.fits' automatically replaced by 'pb.fits' to locate beams.
    name:
      dtype: str
      required: true
      policies:
        positional: true
      info: Prefix to be used for output files.
    num-workers:
      dtype: int
      default: 0
      info: Number of worker threads; 0 uses all available threads.
    associated-mosaics:
      dtype: List[File]
      info: Also make mosaics of associated files; space-separated list. e.g masks, models or residuals
    regrid:
      dtype: bool
      action: store_true
      info: Use montage for regridding images and beams.
    force-regrid:
      dtype: bool
      action: store_true
      info: Force newly-regridded files even if they exist.
    beam-cutoff:
      dtype: float
      default: 0.1
      info: Cutoff in the primary beam (e.g., 0.1 = 10% level).
    mosaic-cutoff:
      dtype: float
      default: 0.2
      info: Sensitivity cutoff in final mosaic; pixels with noise > min_noise / cutoff are blanked.
    unity-weights:
      dtype: bool
      action: store_true
      info: Use weight=1 instead of weight=1/noise**2.
    statistic:
      dtype: str
      choices: [mad, rms, fit, exptime]
      default: mad
      info: Statistic to use for estimating noise in input images.
    guess-std:
      dtype: float
      default: 0.02
      info: Initial guess of noise level for '--statistic fit'.
    ra:
      dtype: float
      info: Central RA (deg) of output mosaic if not imaging full FoV.
    dec:
      dtype: float
      info: Central Dec (deg) of output mosaic if not imaging full FoV.
    velocity:
      dtype: float
      info: Central velocity/frequency of output mosaic cube.
    dra:
      dtype: float
      info: RA range of output mosaic image/cube.
    ddec:
      dtype: float
      info: Dec range of output mosaic image/cube.
    dv:
      dtype: float
      info: Velocity/frequency range of output mosaic cube.
  outputs:
    output:
      dtype: Directory
      mkdir: true
      must_exist: false
      required: true
      policies:
        positional: true
      info: Directory for all output files.
